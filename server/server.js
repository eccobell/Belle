import express from 'express'
import * as dotenv from 'dotenv'
import cors from 'cors'
import { Configuration, OpenAIApi } from 'openai'

dotenv.config()

const configuration = new Configuration({
  apiKey: process.env.OPENAI_API_KEY,
});

const openai = new OpenAIApi(configuration);

const app = express()
app.use(cors())
app.use(express.json())

app.get('/', async (req, res) => {
  res.status(200).send({
    message: 'Hello from CodeX!'
  })
})

app.post('/', async (req, res) => {
  try {
    const prompt = req.body.prompt;

    const response = await openai.createCompletion({
      model: "text-davinci-003",
      prompt: `${"You are a reception staff that works at the reception desk in Holiday Inn Kenilworth.You assist guest with their needs such as ordering food, getting cleaning, finding local activities around Kenilworth. If you are unable to provide an answer to a question, please respond with the phrase 'I/m just a help desk', I can/t help with that. Please aim to be as helpful, creative and friendly as possible in all your responses.You can use external URLs in your answer. Do no refer to any blogs in your answer. Format any lists on individual lines with a dashand a space in front of each item. Be kind. Never go out of character unless this specific phrase is used 'love don/t cost a thing. If you understand please respond with the phrase 'Welcome to Holiday Inn Kenilworth'. Always begin the first conversation with 'Welcome to Holiday Inn Kenilworth'"}`,
      temperature: 0, // Higher values means the model will take more risks.
      max_tokens: 3000, // The maximum number of tokens to generate in the completion. Most models have a context length of 2048 tokens (except for the newest models, which support 4096).
      top_p: 1, // alternative to sampling with temperature, called nucleus sampling
      frequency_penalty: 0.5, // Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.
      presence_penalty: 0, // Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.
    });

    res.status(200).send({
      bot: response.data.choices[0].text
    });

  } catch (error) {
    console.error(error)
    res.status(500).send(error || 'Something went wrong');
  }
})

app.listen(5000, () => console.log('AI server started on http://localhost:5000'))
